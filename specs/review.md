last commit: deb78c1
status: not ok
review comments:
- `bun run typecheck` still fails because the mock returned by `Factory.createHttpConnection()` does not satisfy either interface it claims to implement. `EventsBatchController.handle` expects a `contracts/connection.Connection`, but `Factory.handleBatchEvents` passes `HttpConnection` from `./http/connection` at `src/servers/reverb/factory.ts:847`, so TypeScript raises `TS2345` (the mock lacks `lastSeenAt`, `hasBeenPinged`, etc.). The same stub is also typed as `HttpConnection` yet omits required members (`connection`, `close`) and tries to access private fields, triggering the cluster of errors at `src/servers/reverb/factory.ts:1227-1255`. The HTTP controllers still cannot compile until this connection adapter is reworked to satisfy the actual contracts.
- `Factory.convertToHttpRequest()` now returns an object literal typed as `IHttpRequest & { url: string; httpVersion: string; getSize(): number }`, but it also defines a top-level `headers` property that `IHttpRequest` does not declare. With excess-property checking enabled, TypeScript rejects this at `src/servers/reverb/factory.ts:1191 (TS2353)`, so the build never reaches runtime.
- Objective 0 from `scripts/ralph/current.md` is unmet: `bun run lint` still reports nine `lint/suspicious/noExplicitAny` violations across the test suite (`tests/e2e/websocket-connection.test.ts:96`, `tests/feature/health-check-controller.test.ts:5`, `tests/unit/channels/channel.test.ts:25` & `61`, and `tests/unit/events/event-dispatcher.test.ts:22`, `75`, `307`, `311`, `315`). Husky will keep blocking commits until these `any` annotations are replaced with concrete types.
