last commit: f3c9c9edcf131545e8b9092c4f3bfd984a5f2c9c
status: not ok
review comments:
- revurb-ts/src/config/load.ts:186-337 always calls `loadReverbAppConfig()`, which throws if the REVERB_APP_* env vars are unset, and then shallowly overwrites `config.apps` with that env-generated payload. As a result you cannot boot the TypeScript server with only a `reverb.config.ts` (or define multiple config-driven apps) the way the PHP port allows—`revurb start --config ...` still dies before your file is read, and even if the import succeeds the env stub replaces your `apps`. Please skip the env-only path when a config file is supplied and merge/append apps instead of replacing them so config-driven deployments work again.
- revurb-ts/src/Servers/Reverb/factory.ts:1045-1085 + revurb-ts/src/Protocols/Pusher/Http/Controllers/{connections-controller.ts:70-198, channel-users-controller.ts:120-217}: `convertToHttpRequest()` stores `pathname + search` in `request.path`, and those controllers feed `request.getPath()` straight into the signature string without stripping the query. Pusher signatures are calculated over the path *without* the query string, so any signed GET to `/apps/{id}/connections` or `/channels/{channel}/users` now fails with “Authentication signature invalid.” even when the signature matches the PHP server. Trim the query portion (as the PHP controllers do) before building `signatureString`.
- revurb-ts/src/application-manager.ts:97-125 defaults `allowed_origins` to `[]` when apps come from config, but `Server.verifyOrigin()` (revurb-ts/src/Protocols/Pusher/server.ts:256-279) treats an empty list as “block everything.” The PHP config defaults this field to `['*']`, so omitting it still allows browsers to connect. Right now any config-defined app without an explicit `allowed_origins` immediately hits `InvalidOrigin` on handshake. Please align the default with the PHP implementation.
